"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[3064],{21898:(P,v,a)=>{a.r(v),a.d(v,{default:()=>ae});var e=a(58827),h=a(21272),j=a(74930),x=a(54894),t=a(91356),Y=a(69414),I=a(72178),T=a(98133),R=a(37421),s=a(56914);const O=async()=>{const{data:i}=await s.SP.get((0,s.X3)("email-templates"));return i},$=i=>s.SP.put((0,s.X3)("email-templates"),i);var Q=a(33544),n=a.n(Q),l=a(90265),L=a(52120),E=a(58494),S=a(93802),F=a(35266),Z=a(8895),A=a.n(Z),D=a(59263),X=a.n(D),z=a(62328),W=a.n(z);const B=({canUpdate:i,onEditClick:d})=>{const{formatMessage:o}=(0,x.A)();return(0,e.jsxs)(l.Table,{colCount:3,rowCount:3,children:[(0,e.jsx)(l.Thead,{children:(0,e.jsxs)(l.Tr,{children:[(0,e.jsx)(l.Th,{width:"1%",children:(0,e.jsx)(L.VisuallyHidden,{children:o({id:(0,s.gT)("Email.template.table.icon.label"),defaultMessage:"icon"})})}),(0,e.jsx)(l.Th,{children:(0,e.jsx)(E.Typography,{variant:"sigma",textColor:"neutral600",children:o({id:(0,s.gT)("Email.template.table.name.label"),defaultMessage:"name"})})}),(0,e.jsx)(l.Th,{width:"1%",children:(0,e.jsx)(L.VisuallyHidden,{children:o({id:(0,s.gT)("Email.template.table.action.label"),defaultMessage:"action"})})})]})}),(0,e.jsxs)(l.Tbody,{children:[(0,e.jsxs)(l.Tr,{...(0,t.onRowClick)({fn:()=>d("reset_password")}),children:[(0,e.jsx)(l.Td,{children:(0,e.jsx)(F.Icon,{children:(0,e.jsx)(X(),{"aria-label":o({id:"global.reset-password",defaultMessage:"Reset password"})})})}),(0,e.jsx)(l.Td,{children:(0,e.jsx)(E.Typography,{children:o({id:"global.reset-password",defaultMessage:"Reset password"})})}),(0,e.jsx)(l.Td,{...t.stopPropagation,children:(0,e.jsx)(S.IconButton,{onClick:()=>d("reset_password"),label:o({id:(0,s.gT)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:i&&(0,e.jsx)(A(),{})})})]}),(0,e.jsxs)(l.Tr,{...(0,t.onRowClick)({fn:()=>d("email_confirmation")}),children:[(0,e.jsx)(l.Td,{children:(0,e.jsx)(F.Icon,{children:(0,e.jsx)(W(),{"aria-label":o({id:(0,s.gT)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"})})})}),(0,e.jsx)(l.Td,{children:(0,e.jsx)(E.Typography,{children:o({id:(0,s.gT)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"})})}),(0,e.jsx)(l.Td,{...t.stopPropagation,children:(0,e.jsx)(S.IconButton,{onClick:()=>d("email_confirmation"),label:o({id:(0,s.gT)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:i&&(0,e.jsx)(A(),{})})})]})]})]})};B.propTypes={canUpdate:n().bool.isRequired,onEditClick:n().func.isRequired};const J=B;var K=a(61535),y=a(68586),f=a(4527),G=a(93995),M=a(14887),k=a(66521),c=a(48656);const w=c.Ik().shape({options:c.Ik().shape({from:c.Ik().shape({name:c.Yj().required(t.translatedErrors.required),email:c.Yj().email(t.translatedErrors.email).required(t.translatedErrors.required)}).required(),response_email:c.Yj().email(t.translatedErrors.email),object:c.Yj().required(t.translatedErrors.required),message:c.Yj().required(t.translatedErrors.required)}).required(t.translatedErrors.required)}),H=({template:i,onToggle:d,onSubmit:o})=>{const{formatMessage:r}=(0,x.A)();return(0,e.jsxs)(y.ModalLayout,{onClose:d,labelledBy:`${r({id:(0,s.gT)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${r({id:(0,s.gT)(i.display),defaultMessage:i.display})}`,children:[(0,e.jsx)(y.ModalHeader,{children:(0,e.jsxs)(M.Breadcrumbs,{label:`${r({id:(0,s.gT)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${r({id:(0,s.gT)(i.display),defaultMessage:i.display})}`,children:[(0,e.jsx)(M.Crumb,{children:r({id:(0,s.gT)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}),(0,e.jsx)(M.Crumb,{children:r({id:(0,s.gT)(i.display),defaultMessage:i.display})})]})}),(0,e.jsx)(K.Formik,{onSubmit:o,initialValues:i,validateOnChange:!1,validationSchema:w,enableReinitialize:!0,children:({errors:m,values:p,handleChange:u,isSubmitting:b})=>(0,e.jsxs)(t.Form,{children:[(0,e.jsx)(y.ModalBody,{children:(0,e.jsxs)(f.Grid,{gap:5,children:[(0,e.jsx)(f.GridItem,{col:6,s:12,children:(0,e.jsx)(t.GenericInput,{intlLabel:{id:(0,s.gT)("PopUpForm.Email.options.from.name.label"),defaultMessage:"Shipper name"},name:"options.from.name",onChange:u,value:p.options.from.name,error:m?.options?.from?.name,type:"text"})}),(0,e.jsx)(f.GridItem,{col:6,s:12,children:(0,e.jsx)(t.GenericInput,{intlLabel:{id:(0,s.gT)("PopUpForm.Email.options.from.email.label"),defaultMessage:"Shipper email"},name:"options.from.email",onChange:u,value:p.options.from.email,error:m?.options?.from?.email,type:"text"})}),(0,e.jsx)(f.GridItem,{col:6,s:12,children:(0,e.jsx)(t.GenericInput,{intlLabel:{id:(0,s.gT)("PopUpForm.Email.options.response_email.label"),defaultMessage:"Response email"},name:"options.response_email",onChange:u,value:p.options.response_email,error:m?.options?.response_email,type:"text"})}),(0,e.jsx)(f.GridItem,{col:6,s:12,children:(0,e.jsx)(t.GenericInput,{intlLabel:{id:(0,s.gT)("PopUpForm.Email.options.object.label"),defaultMessage:"Subject"},name:"options.object",onChange:u,value:p.options.object,error:m?.options?.object,type:"text"})}),(0,e.jsx)(f.GridItem,{col:12,s:12,children:(0,e.jsx)(k.Textarea,{label:r({id:(0,s.gT)("PopUpForm.Email.options.message.label"),defaultMessage:"Message"}),name:"options.message",onChange:u,value:p.options.message,error:m?.options?.message&&r({id:m.options.message,defaultMessage:m.options.message})})})]})}),(0,e.jsx)(y.ModalFooter,{startActions:(0,e.jsx)(G.Button,{onClick:d,variant:"tertiary",children:"Cancel"}),endActions:(0,e.jsx)(G.Button,{loading:b,type:"submit",children:"Finish"})})]})})]})};H.propTypes={template:n().shape({display:n().string,icon:n().string,options:n().shape({from:n().shape({name:n().string,email:n().string}),message:n().string,object:n().string,response_email:n().string})}).isRequired,onSubmit:n().func.isRequired,onToggle:n().func.isRequired};const q=H,_=()=>(0,e.jsx)(t.CheckPagePermissions,{permissions:R.A.readEmailTemplates,children:(0,e.jsx)(ee,{})}),ee=()=>{const{formatMessage:i}=(0,x.A)(),{trackUsage:d}=(0,t.useTracking)(),{notifyStatus:o}=(0,Y.useNotifyAT)(),r=(0,t.useNotification)(),{lockApp:m,unlockApp:p}=(0,t.useOverlayBlocker)(),u=(0,h.useRef)(d),b=(0,j.useQueryClient)();(0,t.useFocusWhenNavigate)();const[se,te]=(0,h.useState)(!1),[U,ie]=(0,h.useState)(null),le=(0,h.useMemo)(()=>({update:R.A.updateEmailTemplates}),[]),{isLoading:ne,allowedActions:{canUpdate:oe}}=(0,t.useRBAC)(le),{status:re,data:N}=(0,j.useQuery)("email-templates",()=>O(),{onSuccess:()=>{o(i({id:(0,s.gT)("Email.template.data.loaded"),defaultMessage:"Email templates has been loaded"}))},onError:()=>{r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),de=ne||re!=="success",C=()=>{te(g=>!g)},me=g=>{ie(g),C()},V=(0,j.useMutation)(g=>$({"email-templates":g}),{onSuccess:async()=>{await b.invalidateQueries("email-templates"),r({type:"success",message:{id:"notification.success.saved",defaultMessage:"Saved"}}),u.current("didEditEmailTemplates"),p(),C()},onError:()=>{r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),p()},refetchActive:!0}),{isLoading:ce}=V,pe=g=>{m(),u.current("willEditEmailTemplates");const ue={...N,[U]:g};V.mutate(ue)};return de?(0,e.jsxs)(I.Main,{"aria-busy":"true",children:[(0,e.jsx)(t.SettingsPageTitle,{name:i({id:(0,s.gT)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),(0,e.jsx)(T.HeaderLayout,{title:i({id:(0,s.gT)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),(0,e.jsx)(T.ContentLayout,{children:(0,e.jsx)(t.LoadingIndicatorPage,{})})]}):(0,e.jsxs)(I.Main,{"aria-busy":ce,children:[(0,e.jsx)(t.SettingsPageTitle,{name:i({id:(0,s.gT)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),(0,e.jsx)(T.HeaderLayout,{title:i({id:(0,s.gT)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),(0,e.jsxs)(T.ContentLayout,{children:[(0,e.jsx)(J,{onEditClick:me,canUpdate:oe}),se&&(0,e.jsx)(q,{template:N[U],onToggle:C,onSubmit:pe})]})]})},ae=_},59263:(P,v,a)=>{const e=a(92132),h=x=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...x,children:e.jsx("path",{fill:"#212134",fillRule:"evenodd",d:"M15.681 2.804A9.64 9.64 0 0 0 11.818 2C6.398 2 2 6.48 2 12c0 5.521 4.397 10 9.818 10 2.03 0 4.011-.641 5.67-1.835a9.987 9.987 0 0 0 3.589-4.831 1.117 1.117 0 0 0-.664-1.418 1.086 1.086 0 0 0-1.393.676 7.769 7.769 0 0 1-2.792 3.758 7.546 7.546 0 0 1-4.41 1.428V4.222h.002a7.492 7.492 0 0 1 3.003.625 7.61 7.61 0 0 1 2.5 1.762l.464.551-2.986 3.042a.186.186 0 0 0 .129.316H22V3.317a.188.188 0 0 0-.112-.172.179.179 0 0 0-.199.04l-2.355 2.4-.394-.468-.02-.02a9.791 9.791 0 0 0-3.239-2.293Zm-3.863 1.418V2v2.222Zm0 0v15.556c-4.216 0-7.636-3.484-7.636-7.778s3.42-7.777 7.636-7.778Z",clipRule:"evenodd"})}),j=h;P.exports=j}}]);
