"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[8754],{67385:(k,f,a)=>{a.r(f),a.d(f,{default:()=>O});var t=a(58827),j=a(21272),c=a(74930),A=a(54894),E=a(61535),n=a(91356),F=a(69414),p=a(72178),l=a(98133),L=a(93995),b=a(19016),C=a(70505),h=a(52227),P=a(58494),g=a(4527),R=a(62328),N=a.n(R),v=a(37421),e=a(56914);const w=[{intlLabel:{id:(0,e.gT)("EditForm.inputToggle.label.email"),defaultMessage:"One account per email address"},description:{id:(0,e.gT)("EditForm.inputToggle.description.email"),defaultMessage:"Disallow the user to create multiple accounts using the same email address with different authentication providers."},name:"unique_email",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,e.gT)("EditForm.inputToggle.label.sign-up"),defaultMessage:"Enable sign-ups"},description:{id:(0,e.gT)("EditForm.inputToggle.description.sign-up"),defaultMessage:"When disabled (OFF), the registration process is forbidden. No one can subscribe anymore no matter the used provider."},name:"allow_register",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,e.gT)("EditForm.inputToggle.label.email-reset-password"),defaultMessage:"Reset password page"},description:{id:(0,e.gT)("EditForm.inputToggle.description.email-reset-password"),defaultMessage:"URL of your application's reset password page."},placeholder:{id:(0,e.gT)("EditForm.inputToggle.placeholder.email-reset-password"),defaultMessage:"ex: https://youtfrontend.com/reset-password"},name:"email_reset_password",type:"text",size:{col:6,xs:12}},{intlLabel:{id:(0,e.gT)("EditForm.inputToggle.label.email-confirmation"),defaultMessage:"Enable email confirmation"},description:{id:(0,e.gT)("EditForm.inputToggle.description.email-confirmation"),defaultMessage:"When enabled (ON), new registered users receive a confirmation email."},name:"email_confirmation",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,e.gT)("EditForm.inputToggle.label.email-confirmation-redirection"),defaultMessage:"Redirection url"},description:{id:(0,e.gT)("EditForm.inputToggle.description.email-confirmation-redirection"),defaultMessage:"After you confirmed your email, choose where you will be redirected."},placeholder:{id:(0,e.gT)("EditForm.inputToggle.placeholder.email-confirmation-redirection"),defaultMessage:"ex: https://youtfrontend.com/email-confirmation"},name:"email_confirmation_redirection",type:"text",size:{col:6,xs:12}}];var d=a(48656);const y=new RegExp("(^$)|((.+:\\/\\/.*)(d*)\\/?(.*))"),z=d.Ik().shape({email_confirmation_redirection:d.gl().when("email_confirmation",{is:!0,then:d.Yj().matches(y).required(),otherwise:d.Yj().nullable()}),email_reset_password:d.Yj(n.translatedErrors.string).matches(y,n.translatedErrors.regex).nullable()}),I=async()=>{const{data:i}=await e.SP.get((0,e.X3)("advanced"));return i},B=i=>e.SP.put((0,e.X3)("advanced"),i),G=()=>(0,t.jsx)(n.CheckPagePermissions,{permissions:v.A.readAdvancedSettings,children:(0,t.jsx)(H,{})}),H=()=>{const{formatMessage:i}=(0,A.A)(),u=(0,n.useNotification)(),{lockApp:D,unlockApp:T}=(0,n.useOverlayBlocker)(),{notifyStatus:Q}=(0,F.useNotifyAT)(),U=(0,c.useQueryClient)();(0,n.useFocusWhenNavigate)();const W=(0,j.useMemo)(()=>({update:v.A.updateAdvancedSettings}),[]),{isLoading:X,allowedActions:{canUpdate:Y}}=(0,n.useRBAC)(W),{status:V,data:x}=(0,c.useQuery)("advanced",()=>I(),{onSuccess:()=>{Q(i({id:(0,e.gT)("Form.advancedSettings.data.loaded"),defaultMessage:"Advanced settings data has been loaded"}))},onError:()=>{u({type:"warning",message:{id:(0,e.gT)("notification.error"),defaultMessage:"An error occured"}})}}),$=X||V!=="success",S=(0,c.useMutation)(o=>B(o),{onSuccess:async()=>{await U.invalidateQueries("advanced"),u({type:"success",message:{id:(0,e.gT)("notification.success.saved"),defaultMessage:"Saved"}}),T()},onError:()=>{u({type:"warning",message:{id:(0,e.gT)("notification.error"),defaultMessage:"An error occured"}}),T()},refetchActive:!0}),{isLoading:J}=S,K=async o=>{D();const r=o.email_confirmation?o.email_confirmation_redirection:"";await S.mutateAsync({...o,email_confirmation_redirection:r})};return $?(0,t.jsxs)(p.Main,{"aria-busy":"true",children:[(0,t.jsx)(n.SettingsPageTitle,{name:i({id:(0,e.gT)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),(0,t.jsx)(l.HeaderLayout,{title:i({id:(0,e.gT)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),(0,t.jsx)(l.ContentLayout,{children:(0,t.jsx)(n.LoadingIndicatorPage,{})})]}):(0,t.jsxs)(p.Main,{"aria-busy":J,children:[(0,t.jsx)(n.SettingsPageTitle,{name:i({id:(0,e.gT)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),(0,t.jsx)(E.Formik,{onSubmit:K,initialValues:x.settings,validateOnChange:!1,validationSchema:z,enableReinitialize:!0,children:({errors:o,values:r,handleChange:M,isSubmitting:Z})=>(0,t.jsxs)(n.Form,{children:[(0,t.jsx)(l.HeaderLayout,{title:i({id:(0,e.gT)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"}),primaryAction:(0,t.jsx)(L.Button,{loading:Z,type:"submit",disabled:!Y,startIcon:(0,t.jsx)(N(),{}),size:"L",children:i({id:"global.save",defaultMessage:"Save"})})}),(0,t.jsx)(l.ContentLayout,{children:(0,t.jsx)(b.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,t.jsxs)(C.Stack,{spacing:4,children:[(0,t.jsx)(P.Typography,{variant:"delta",as:"h2",children:i({id:"global.settings",defaultMessage:"Settings"})}),(0,t.jsxs)(g.Grid,{gap:6,children:[(0,t.jsx)(g.GridItem,{col:6,s:12,children:(0,t.jsx)(h.Select,{label:i({id:(0,e.gT)("EditForm.inputSelect.label.role"),defaultMessage:"Default role for authenticated users"}),value:r.default_role,hint:i({id:(0,e.gT)("EditForm.inputSelect.description.role"),defaultMessage:"It will attach the new authenticated user to the selected role."}),onChange:s=>M({target:{name:"default_role",value:s}}),children:x.roles.map(s=>(0,t.jsx)(h.Option,{value:s.type,children:s.name},s.type))})}),w.map(s=>{let m=r[s.name];return m||(m=s.type==="bool"?!1:""),(0,t.jsx)(g.GridItem,{...s.size,children:(0,t.jsx)(n.GenericInput,{...s,value:m,error:o[s.name],disabled:s.name==="email_confirmation_redirection"&&r.email_confirmation===!1,onChange:M})},s.name)})]})]})})})]})})]})},O=G}}]);
