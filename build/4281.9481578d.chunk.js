"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[4281],{62482:(ts,p,s)=>{s.d(p,{F:()=>U});var t=s(92132),d=s(21272),y=s(94061),E=s(85963),m=s(91356),c=s(28604),L=s(54894);const U=({displayedFilters:O})=>{const[v,R]=d.useState(!1),{formatMessage:S}=(0,L.A)(),B=d.useRef(null),x=()=>{R(V=>!V)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(y.a,{paddingTop:1,paddingBottom:1,children:[(0,t.jsx)(E.$,{variant:"tertiary",ref:B,startIcon:(0,t.jsx)(c.A,{}),onClick:x,size:"S",children:S({id:"app.utils.filters",defaultMessage:"Filters"})}),v&&(0,t.jsx)(m.FilterPopoverURLQuery,{displayedFilters:O,isVisible:v,onToggle:x,source:B})]}),(0,t.jsx)(m.FilterListURLQuery,{filtersSchema:O})]})}},74281:(ts,p,s)=>{s.d(p,{ProtectedListPage:()=>fs,e:()=>rs});var t=s(92132),d=s(21272),y=s(50215),E=s(94061),m=s(85963),c=s(90151),L=s(68074),U=s(88353),O=s(74773),v=s(4198),R=s(55356),S=s(38413),B=s(61485),x=s(99248),V=s(67030),Z=s(6239),l=s(83997),D=s(25641),F=s(90361),N=s(33363),f=s(85829),e=s(91356),u=s(5409),$=s(54894),q=s(17703),_=s(78803),es=s(62482),g=s(34313),_s=s(41909),ds=s(50612),Es=s(37679),ms=s(60043),Ms=s(61535),b=s(48656),is=s(82803),as=s(66248),us=s(15126),Is=s(63299),Ts=s(67014),Us=s(59080),Rs=s(79275),Bs=s(14718),xs=s(82437),js=s(5790),Ks=s(35223),Ws=s(74930),ps=s(2600),ys=s(48940),Ss=s(41286),Fs=s(56336),Ns=s(13426),$s=s(84624),zs=s(77965),Vs=s(54257),Ys=s(71210),Qs=s(51187),Hs=s(39404),Gs=s(58692),Js=s(501),Xs=s(57646),Zs=s(23120),bs=s(44414),ks=s(25962),ws=s(14664),qs=s(42588),st=s(90325),tt=s(62785),et=s(87443),at=s(41032),nt=s(22957),it=s(93179),ot=s(73055),rt=s(15747),lt=s(85306),_t=s(26509),dt=s(32058),Et=s(81185),mt=s(82261),Mt=s(85071),Pt=s(55151),ct=s(79077);const Ps=({onClick:a})=>{const{formatMessage:i}=(0,$.A)();return(0,t.jsx)(m.$,{onClick:a,startIcon:(0,t.jsx)(g.A,{}),size:"S",children:i({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})})},cs=({onToggle:a})=>{const[i,j]=d.useState("create"),[Y,Q]=d.useState(""),{formatMessage:M}=(0,$.A)(),A=(0,e.useNotification)(),{lockApp:H,unlockApp:I}=(0,e.useOverlayBlocker)(),{_unstableFormatAPIError:G,_unstableFormatValidationErrors:K}=(0,e.useAPIErrorHandler)(),n=(0,_.p)(Os,async()=>(await s.e(9971).then(s.bind(s,79971))).ROLE_LAYOUT,{combine(o,T){return[...o,...T]},defaultValue:[]}),z=(0,_.p)(os,async()=>(await s.e(9971).then(s.bind(s,79971))).FORM_INITIAL_VALUES,{combine(o,T){return{...o,...T}},defaultValue:os}),h=(0,_.p)(is.M,async()=>(await s.e(3153).then(s.bind(s,43153))).MagicLinkEE),[J]=(0,_.H)(),W=M({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),k=async(o,{setErrors:T})=>{H();const P=await J({...o,roles:o.roles??[]});"data"in P?P.data.registrationToken?(Q(P.data.registrationToken),ss()):A({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}):(A({type:"warning",message:G(P.error)}),(0,_.x)(P.error)&&P.error.name==="ValidationError"&&T(K(P.error))),I()},ss=()=>{r?j(r):a()},{buttonSubmitLabel:w,isDisabled:X,next:r}=As[i];return h?(0,t.jsxs)(B.k,{onClose:a,labelledBy:"title",children:[(0,t.jsx)(x.r,{children:(0,t.jsx)(Es.B,{label:W,children:(0,t.jsx)(ms.m,{isCurrent:!0,children:W})})}),(0,t.jsx)(Ms.Formik,{enableReinitialize:!0,initialValues:z??{},onSubmit:k,validationSchema:gs,validateOnChange:!1,children:({errors:o,handleChange:T,values:P,isSubmitting:ls})=>(0,t.jsxs)(e.Form,{children:[(0,t.jsx)(Z.c,{children:(0,t.jsxs)(l.s,{direction:"column",alignItems:"stretch",gap:6,children:[i!=="create"&&(0,t.jsx)(h,{registrationToken:Y}),(0,t.jsxs)(E.a,{children:[(0,t.jsx)(f.o,{variant:"beta",as:"h2",children:M({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})}),(0,t.jsx)(E.a,{paddingTop:4,children:(0,t.jsx)(l.s,{direction:"column",alignItems:"stretch",gap:1,children:(0,t.jsx)(c.x,{gap:5,children:Ds.map(ns=>ns.map(C=>(0,t.jsx)(L.E,{...C.size,children:(0,t.jsx)(e.GenericInput,{...C,disabled:X,error:o[C.name],onChange:T,value:P[C.name]})},C.name)))})})})]}),(0,t.jsxs)(E.a,{children:[(0,t.jsx)(f.o,{variant:"beta",as:"h2",children:M({id:"global.roles",defaultMessage:"User's role"})}),(0,t.jsx)(E.a,{paddingTop:4,children:(0,t.jsxs)(c.x,{gap:5,children:[(0,t.jsx)(L.E,{col:6,xs:12,children:(0,t.jsx)(is.S,{disabled:X,error:o.roles,onChange:T,value:P.roles??[]})}),n.map(ns=>ns.map(C=>(0,t.jsx)(L.E,{...C.size,children:(0,t.jsx)(e.GenericInput,{...C,disabled:X,onChange:T,value:P[C.name]})},C.name)))]})})]})]})}),(0,t.jsx)(V.j,{startActions:(0,t.jsx)(m.$,{variant:"tertiary",onClick:a,type:"button",children:M({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:i==="create"?(0,t.jsx)(m.$,{type:"submit",loading:ls,children:M(w)}):(0,t.jsx)(m.$,{type:"button",loading:ls,onClick:a,children:M(w)})})]})})]}):null},os={firstname:"",lastname:"",email:"",roles:[]},Os=[],Ds=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],gs=b.Ik().shape({firstname:b.Yj().trim().required(e.translatedErrors.required),lastname:b.Yj(),email:b.Yj().email(e.translatedErrors.email).required(e.translatedErrors.required),roles:b.YO().min(1,e.translatedErrors.required).required(e.translatedErrors.required)}),As={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},hs=({canDelete:a,headers:i=[],entriesToDelete:j=[],onClickDelete:Y,onSelectRow:Q,withMainAction:M,withBulkActions:A,rows:H=[]})=>{const{push:I,location:{pathname:G}}=(0,q.W6)(),{formatMessage:K}=(0,$.A)();return(0,t.jsx)(D.N,{children:H.map(n=>{const z=j.findIndex(h=>h===n.id)!==-1;return(0,t.jsxs)(F.Tr,{...(0,e.onRowClick)({fn:()=>I(`${G}/${n.id}`),condition:A}),children:[M&&(0,t.jsx)(N.Td,{...e.stopPropagation,children:(0,t.jsx)(y.J,{"aria-label":K({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,as.g)(n?.firstname??"",n.lastname)}),checked:z,onChange:()=>{Q&&Q({name:n.id,value:!z})}})}),i.map(({key:h,cellFormatter:J,name:W,...k})=>(0,t.jsx)(N.Td,{children:typeof J=="function"?J(n,{key:h,name:W,formatMessage:K,...k}):(0,t.jsx)(f.o,{textColor:"neutral800",children:n[W]||"-"})},h)),A&&(0,t.jsx)(N.Td,{children:(0,t.jsxs)(l.s,{justifyContent:"end",children:[(0,t.jsx)(U.K,{onClick:()=>I(`${G}/${n.id}`),label:K({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,as.g)(n.firstname??"",n.lastname)}),noBorder:!0,icon:(0,t.jsx)(_s.A,{})}),a&&(0,t.jsx)(E.a,{paddingLeft:1,...e.stopPropagation,children:(0,t.jsx)(U.K,{onClick:()=>{Y&&Y(n.id)},label:K({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,as.g)(n.firstname??"",n.lastname)}),noBorder:!0,icon:(0,t.jsx)(ds.A,{})})})]})})]},n.id)})})},rs=()=>{const{_unstableFormatAPIError:a}=(0,e.useAPIErrorHandler)(),[i,j]=d.useState(!1),Y=(0,_.j)(r=>r.admin_app.permissions),{allowedActions:{canCreate:Q,canDelete:M,canRead:A}}=(0,e.useRBAC)(Y.settings?.users),H=(0,e.useNotification)(),{formatMessage:I}=(0,$.A)(),{search:G}=(0,q.zy)();(0,e.useFocusWhenNavigate)();const{data:K,isError:n,isLoading:z}=(0,_.k)(u.parse(G,{ignoreQueryPrefix:!0}),{skip:!A}),{pagination:h,users:J}=K??{},W=(0,_.p)(Ps,async()=>(await s.e(5543).then(s.bind(s,5543))).CreateActionEE),k=Cs.map(r=>({...r,metadatas:{...r.metadatas,label:I(r.metadatas.label)}})),ss=I({id:"global.users",defaultMessage:"Users"}),w=()=>{j(r=>!r)},[X]=(0,_.J)();return W?(0,t.jsxs)(S.g,{"aria-busy":z,children:[(0,t.jsx)(e.SettingsPageTitle,{name:"Users"}),(0,t.jsx)(R.Q,{primaryAction:Q&&(0,t.jsx)(W,{onClick:w}),title:ss,subtitle:I({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),A&&(0,t.jsx)(O.B,{startActions:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.SearchURLQuery,{label:I({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:ss})}),(0,t.jsx)(es.F,{displayedFilters:Ls})]})}),(0,t.jsxs)(v.s,{children:[!A&&(0,t.jsx)(e.NoPermissions,{}),n&&(0,t.jsx)("div",{children:"TODO: An error occurred"}),A&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.DynamicTable,{contentType:"Users",isLoading:z,onConfirmDeleteAll:async r=>{const o=await X({ids:r});"error"in o&&H({type:"warning",message:a(o.error)})},onConfirmDelete:async r=>{const o=await X({ids:[r]});"error"in o&&H({type:"warning",message:a(o.error)})},headers:k,rows:J,withBulkActions:!0,withMainAction:M,children:(0,t.jsx)(hs,{canDelete:M})}),h&&(0,t.jsx)(E.a,{paddingTop:4,children:(0,t.jsxs)(l.s,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,t.jsx)(e.PageSizeURLQuery,{}),(0,t.jsx)(e.PaginationURLQuery,{pagination:h})]})})]})]}),i&&(0,t.jsx)(cs,{onToggle:w})]}):null},Cs=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:a},{formatMessage:i}){return(0,t.jsx)(f.o,{textColor:"neutral800",children:a.map(j=>i({id:`Settings.permissions.users.${j.code}`,defaultMessage:j.name})).join(`,
`)})}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:a},{formatMessage:i}){return(0,t.jsxs)(l.s,{children:[(0,t.jsx)(e.Status,{variant:a?"success":"danger"}),(0,t.jsx)(f.o,{textColor:"neutral800",children:i({id:a?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:a?"Active":"Inactive"})})]})}}],Ls=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],vs=()=>{const a=(0,_.p)(rs,async()=>(await s.e(1160).then(s.bind(s,91160))).UserListPageEE);return a?(0,t.jsx)(a,{}):null},fs=()=>{const a=(0,_.j)(i=>i.admin_app.permissions.settings?.users.main);return(0,t.jsx)(e.CheckPagePermissions,{permissions:a,children:(0,t.jsx)(vs,{})})}},82803:(ts,p,s)=>{s.d(p,{M:()=>S,S:()=>B,a:()=>R});var t=s(92132),d=s(54894),y=s(78803),E=s(88353),m=s(56654),c=s(91356),L=s(90625),U=s(84795),O=s(63891),v=s(85071);const R=({children:l,target:D})=>{const F=(0,c.useNotification)(),{formatMessage:N}=(0,d.A)(),{copy:f}=(0,c.useClipboard)(),e=N({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),u=async()=>{await f(D)&&F({type:"info",message:{id:"notification.link-copied"}})};return(0,t.jsx)(c.ContentBox,{endAction:(0,t.jsx)(E.K,{label:e,noBorder:!0,icon:(0,t.jsx)(L.A,{}),onClick:u}),title:D,titleEllipsis:!0,subtitle:l,icon:(0,t.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})},S=({registrationToken:l})=>{const{formatMessage:D}=(0,d.A)(),F=`${window.location.origin}${(0,y.K)()}/auth/register?registrationToken=${l}`;return(0,t.jsx)(R,{target:F,children:D({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})},B=({disabled:l,error:D,onChange:F,value:N})=>{const{isLoading:f,roles:e}=(0,v.u)(),{formatMessage:u}=(0,d.A)(),$=D?u({id:D,defaultMessage:D}):"",q=u({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),_=u({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),es=u({id:"app.components.Select.placeholder",defaultMessage:"Select"});return(0,t.jsx)(m.KF,{id:"roles",disabled:l,error:$,hint:_,label:q,name:"roles",onChange:g=>{F({target:{name:"roles",value:g}})},placeholder:es,startIcon:f?(0,t.jsx)(Z,{}):void 0,value:N.map(g=>g.toString()),withTags:!0,required:!0,children:e.map(g=>(0,t.jsx)(m.fe,{value:g.id.toString(),children:u({id:`global.${g.code}`,defaultMessage:g.name})},g.id))})},x=(0,O.keyframes)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,V=O.default.div`
  animation: ${x} 2s infinite linear;
`,Z=()=>(0,t.jsx)(V,{children:(0,t.jsx)(U.A,{})})},85071:(ts,p,s)=>{s.d(p,{u:()=>m});var t=s(21272),d=s(91356),y=s(54894),E=s(78803);const m=(c={},L)=>{const{locale:U}=(0,y.A)(),O=(0,d.useCollator)(U,{sensitivity:"base"}),{data:v,error:R,isError:S,isLoading:B,refetch:x}=(0,E.z)(c,L);return{roles:t.useMemo(()=>[...v??[]].sort((Z,l)=>O.compare(Z.name,l.name)),[v,O]),error:R,isError:S,isLoading:B,refetch:x}}}}]);
