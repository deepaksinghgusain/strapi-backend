"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[187],{60187:(ps,D,e)=>{e.r(D),e.d(D,{default:()=>ss});var s=e(92132),T=e(21272),x=e(85963),b=e(90151),c=e(68074),f=e(58805),y=e(88353),C=e(4198),v=e(55356),N=e(11273),A=e(38413),$=e(61485),H=e(99248),Q=e(67030),Y=e(6239),G=e(35513),z=e(25641),V=e(26127),M=e(90361),m=e(33363),X=e(5287),P=e(85829),I=e(98765),a=e(91356),u=e(54894),j=e(74930),t=e(99105),gs=e(77965),J=e(37679),R=e(60043),Z=e(61535),l=e(33544),E=e(48656),k=e(54514),L=e(41909),w=e(70603);const q=E.Ik().shape({options:E.Ik().shape({from:E.Ik().shape({name:E.Yj().required(a.translatedErrors.required),email:E.Yj().email(a.translatedErrors.email).required(a.translatedErrors.required)}).required(),response_email:E.Yj().email(a.translatedErrors.email),object:E.Yj().required(a.translatedErrors.required),message:E.Yj().required(a.translatedErrors.required)}).required(a.translatedErrors.required)}),U=({template:i,onToggle:d,onSubmit:n})=>{const{formatMessage:r}=(0,u.A)();return(0,s.jsxs)($.k,{onClose:d,labelledBy:`${r({id:(0,t.g)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${r({id:(0,t.g)(i.display),defaultMessage:i.display})}`,children:[(0,s.jsx)(H.r,{children:(0,s.jsxs)(J.B,{label:`${r({id:(0,t.g)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${r({id:(0,t.g)(i.display),defaultMessage:i.display})}`,children:[(0,s.jsx)(R.m,{children:r({id:(0,t.g)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}),(0,s.jsx)(R.m,{isCurrent:!0,children:r({id:(0,t.g)(i.display),defaultMessage:i.display})})]})}),(0,s.jsx)(Z.Formik,{onSubmit:n,initialValues:i,validateOnChange:!1,validationSchema:q,enableReinitialize:!0,children:({errors:_,values:p,handleChange:g,isSubmitting:O})=>(0,s.jsxs)(a.Form,{children:[(0,s.jsx)(Y.c,{children:(0,s.jsxs)(b.x,{gap:5,children:[(0,s.jsx)(c.E,{col:6,s:12,children:(0,s.jsx)(a.GenericInput,{intlLabel:{id:(0,t.g)("PopUpForm.Email.options.from.name.label"),defaultMessage:"Shipper name"},name:"options.from.name",onChange:g,value:p.options.from.name,error:_?.options?.from?.name,type:"text"})}),(0,s.jsx)(c.E,{col:6,s:12,children:(0,s.jsx)(a.GenericInput,{intlLabel:{id:(0,t.g)("PopUpForm.Email.options.from.email.label"),defaultMessage:"Shipper email"},name:"options.from.email",onChange:g,value:p.options.from.email,error:_?.options?.from?.email,type:"text"})}),(0,s.jsx)(c.E,{col:6,s:12,children:(0,s.jsx)(a.GenericInput,{intlLabel:{id:(0,t.g)("PopUpForm.Email.options.response_email.label"),defaultMessage:"Response email"},name:"options.response_email",onChange:g,value:p.options.response_email,error:_?.options?.response_email,type:"text"})}),(0,s.jsx)(c.E,{col:6,s:12,children:(0,s.jsx)(a.GenericInput,{intlLabel:{id:(0,t.g)("PopUpForm.Email.options.object.label"),defaultMessage:"Subject"},name:"options.object",onChange:g,value:p.options.object,error:_?.options?.object,type:"text"})}),(0,s.jsx)(c.E,{col:12,s:12,children:(0,s.jsx)(X.T,{label:r({id:(0,t.g)("PopUpForm.Email.options.message.label"),defaultMessage:"Message"}),id:"options.message",onChange:g,value:p.options.message,error:_?.options?.message&&r({id:_.options.message,defaultMessage:_.options.message})})})]})}),(0,s.jsx)(Q.j,{startActions:(0,s.jsx)(x.$,{onClick:d,variant:"tertiary",children:"Cancel"}),endActions:(0,s.jsx)(x.$,{loading:O,type:"submit",children:"Finish"})})]})})]})};U.propTypes={template:l.shape({display:l.string,icon:l.string,options:l.shape({from:l.shape({name:l.string,email:l.string}),message:l.string,object:l.string,response_email:l.string})}).isRequired,onSubmit:l.func.isRequired,onToggle:l.func.isRequired};const B=({canUpdate:i,onEditClick:d})=>{const{formatMessage:n}=(0,u.A)();return(0,s.jsxs)(G.X,{colCount:3,rowCount:3,children:[(0,s.jsx)(V.d,{children:(0,s.jsxs)(M.Tr,{children:[(0,s.jsx)(m.Th,{width:"1%",children:(0,s.jsx)(I.s,{children:n({id:(0,t.g)("Email.template.table.icon.label"),defaultMessage:"icon"})})}),(0,s.jsx)(m.Th,{children:(0,s.jsx)(P.o,{variant:"sigma",textColor:"neutral600",children:n({id:(0,t.g)("Email.template.table.name.label"),defaultMessage:"name"})})}),(0,s.jsx)(m.Th,{width:"1%",children:(0,s.jsx)(I.s,{children:n({id:(0,t.g)("Email.template.table.action.label"),defaultMessage:"action"})})})]})}),(0,s.jsxs)(z.N,{children:[(0,s.jsxs)(M.Tr,{...(0,a.onRowClick)({fn:()=>d("reset_password")}),children:[(0,s.jsx)(m.Td,{children:(0,s.jsx)(f.I,{children:(0,s.jsx)(w.A,{"aria-label":n({id:"global.reset-password",defaultMessage:"Reset password"})})})}),(0,s.jsx)(m.Td,{children:(0,s.jsx)(P.o,{children:n({id:"global.reset-password",defaultMessage:"Reset password"})})}),(0,s.jsx)(m.Td,{...a.stopPropagation,children:(0,s.jsx)(y.K,{onClick:()=>d("reset_password"),label:n({id:(0,t.g)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:i&&(0,s.jsx)(L.A,{})})})]}),(0,s.jsxs)(M.Tr,{...(0,a.onRowClick)({fn:()=>d("email_confirmation")}),children:[(0,s.jsx)(m.Td,{children:(0,s.jsx)(f.I,{children:(0,s.jsx)(k.A,{"aria-label":n({id:(0,t.g)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"})})})}),(0,s.jsx)(m.Td,{children:(0,s.jsx)(P.o,{children:n({id:(0,t.g)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"})})}),(0,s.jsx)(m.Td,{...a.stopPropagation,children:(0,s.jsx)(y.K,{onClick:()=>d("email_confirmation"),label:n({id:(0,t.g)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:i&&(0,s.jsx)(L.A,{})})})]})]})]})};B.propTypes={canUpdate:l.bool.isRequired,onEditClick:l.func.isRequired};const ss=()=>(0,s.jsx)(a.CheckPagePermissions,{permissions:t.P.readEmailTemplates,children:(0,s.jsx)(es,{})}),es=()=>{const{formatMessage:i}=(0,u.A)(),{trackUsage:d}=(0,a.useTracking)(),{notifyStatus:n}=(0,N.W)(),r=(0,a.useNotification)(),{lockApp:_,unlockApp:p}=(0,a.useOverlayBlocker)(),g=(0,j.useQueryClient)(),{get:O,put:as}=(0,a.useFetchClient)(),{formatAPIError:K}=(0,a.useAPIErrorHandler)();(0,a.useFocusWhenNavigate)();const[ts,is]=T.useState(!1),[W,ls]=T.useState(null),{isLoading:ns,allowedActions:{canUpdate:os}}=(0,a.useRBAC)({update:t.P.updateEmailTemplates}),{isLoading:rs,data:F}=(0,j.useQuery)(["users-permissions","email-templates"],async()=>{const{data:o}=await O("/users-permissions/email-templates");return o},{onSuccess(){n(i({id:(0,t.g)("Email.template.data.loaded"),defaultMessage:"Email templates has been loaded"}))},onError(o){r({type:"warning",message:K(o)})}}),ds=ns||rs,h=()=>{is(o=>!o)},ms=o=>{ls(o),h()},S=(0,j.useMutation)(o=>as("/users-permissions/email-templates",{"email-templates":o}),{async onSuccess(){await g.invalidateQueries(["users-permissions","email-templates"]),r({type:"success",message:{id:"notification.success.saved",defaultMessage:"Saved"}}),d("didEditEmailTemplates"),p(),h()},onError(o){r({type:"warning",message:K(o)}),p()},refetchActive:!0}),_s=o=>{_(),d("willEditEmailTemplates");const Es={...F,[W]:o};S.mutate(Es)};return ds?(0,s.jsxs)(A.g,{"aria-busy":"true",children:[(0,s.jsx)(a.SettingsPageTitle,{name:i({id:(0,t.g)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),(0,s.jsx)(v.Q,{title:i({id:(0,t.g)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),(0,s.jsx)(C.s,{children:(0,s.jsx)(a.LoadingIndicatorPage,{})})]}):(0,s.jsxs)(A.g,{"aria-busy":S.isLoading,children:[(0,s.jsx)(a.SettingsPageTitle,{name:i({id:(0,t.g)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),(0,s.jsx)(v.Q,{title:i({id:(0,t.g)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),(0,s.jsxs)(C.s,{children:[(0,s.jsx)(B,{onEditClick:ms,canUpdate:os}),ts&&(0,s.jsx)(U,{template:F[W],onToggle:h,onSubmit:_s})]})]})}}}]);
