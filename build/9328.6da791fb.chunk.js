"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[9328],{85071:(y,D,s)=>{s.d(D,{u:()=>h});var t=s(21272),g=s(91356),R=s(54894),i=s(78803);const h=(m={},L)=>{const{locale:A}=(0,R.A)(),P=(0,g.useCollator)(A,{sensitivity:"base"}),{data:d,error:C,isError:v,isLoading:c,refetch:I}=(0,i.z)(m,L);return{roles:t.useMemo(()=>[...d??[]].sort((B,T)=>P.compare(B.name,T.name)),[d,P]),error:C,isError:v,isLoading:c,refetch:I}}},89328:(y,D,s)=>{s.d(D,{ProtectedSSO:()=>F});var t=s(92132),g=s(85963),R=s(90151),i=s(68074),h=s(42455),m=s(4198),L=s(55356),A=s(38413),P=s(83997),d=s(56654),C=s(43739),v=s(95336),c=s(7441),I=s(85829),o=s(91356),B=s(54514),T=s(61535),j=s(54894),r=s(48656),M=s(78803),x=s(85071),q=s(15126),ss=s(63299),ts=s(67014),as=s(59080),os=s(79275),_s=s(14718),es=s(21272),ns=s(82437),ls=s(5790),Es=s(35223),is=s(5409),ds=s(74930),rs=s(2600),Ms=s(48940),Ps=s(41286),Os=s(56336),Ds=s(13426),gs=s(84624),Rs=s(77965),hs=s(54257),ms=s(71210),Ls=s(51187),As=s(39404),Cs=s(58692),vs=s(501),cs=s(57646),Is=s(23120),Bs=s(44414),Ts=s(25962),Us=s(14664),Ws=s(42588),Ks=s(90325),fs=s(62785),us=s(87443),ys=s(41032),js=s(22957),xs=s(93179),Ss=s(73055),ps=s(15747),Fs=s(85306),Ns=s(26509),zs=s(32058),Vs=s(81185),Gs=s(82261);const S=r.Ik().shape({autoRegister:r.lc().required(o.translatedErrors.required),defaultRole:r.gl().when("autoRegister",(a,_)=>a?_.required(o.translatedErrors.required):_.nullable()),ssoLockedRoles:r.YO().nullable().of(r.gl().when("ssoLockedRoles",(a,_)=>a?_.required(o.translatedErrors.required):_.nullable()))}),p=()=>{(0,o.useFocusWhenNavigate)();const{formatMessage:a}=(0,j.A)(),_=(0,M.j)(l=>l.admin_app.permissions),{lockApp:N,unlockApp:z}=(0,o.useOverlayBlocker)(),U=(0,o.useNotification)(),{_unstableFormatAPIError:V,_unstableFormatValidationErrors:G}=(0,o.useAPIErrorHandler)(),{isLoading:H,data:Q}=(0,M.W)(),[X,{isLoading:Y}]=(0,M.X)(),{isLoading:$,allowedActions:{canUpdate:W,canReadRoles:J}}=(0,o.useRBAC)({..._.settings?.sso,readRoles:_.settings?.roles.read??[]}),{roles:f,isLoading:Z}=(0,x.u)(void 0,{skip:!J}),k=async(l,O)=>{N();try{const e=await X(l);if("error"in e){(0,M.x)(e.error)&&e.error.name==="ValidationError"?O.setErrors(G(e.error)):U({type:"warning",message:V(e.error)});return}U({type:"success",message:{id:"notification.success.saved"}})}catch{U({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred, please try again."}})}finally{z()}},u=Z||$||H;return(0,t.jsxs)(h.P,{children:[(0,t.jsx)(o.SettingsPageTitle,{name:"SSO"}),(0,t.jsx)(A.g,{"aria-busy":Y||u,tabIndex:-1,children:(0,t.jsx)(T.Formik,{onSubmit:k,initialValues:Q||{autoRegister:!1,defaultRole:null,ssoLockedRoles:null},validationSchema:S,validateOnChange:!1,enableReinitialize:!0,children:({handleChange:l,isSubmitting:O,values:e,setFieldValue:b,dirty:w,errors:E})=>(0,t.jsxs)(o.Form,{children:[(0,t.jsx)(L.Q,{primaryAction:(0,t.jsx)(g.$,{disabled:!w,loading:O,startIcon:(0,t.jsx)(B.A,{}),type:"submit",size:"L",children:a({id:"global.save",defaultMessage:"Save"})}),title:a({id:"Settings.sso.title",defaultMessage:"Single Sign-On"}),subtitle:a({id:"Settings.sso.description",defaultMessage:"Configure the settings for the Single Sign-On feature."})}),(0,t.jsx)(m.s,{children:O||u?(0,t.jsx)(o.LoadingIndicatorPage,{}):(0,t.jsxs)(P.s,{direction:"column",alignItems:"stretch",gap:4,background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:[(0,t.jsx)(I.o,{variant:"delta",as:"h2",children:a({id:"global.settings",defaultMessage:"Settings"})}),(0,t.jsxs)(R.x,{gap:4,children:[(0,t.jsx)(i.E,{col:6,s:12,children:(0,t.jsx)(c.l,{disabled:!W,checked:e.autoRegister,hint:a({id:"Settings.sso.form.registration.description",defaultMessage:"Create new user on SSO login if no account exists"}),label:a({id:"Settings.sso.form.registration.label",defaultMessage:"Auto-registration"}),name:"autoRegister",offLabel:a({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:a({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:l})}),(0,t.jsx)(i.E,{col:6,s:12,children:(0,t.jsx)(C.l,{disabled:!W,hint:a({id:"Settings.sso.form.defaultRole.description",defaultMessage:"It will attach the new authenticated user to the selected role"}),error:E.defaultRole?a({id:E.defaultRole,defaultMessage:E.defaultRole}):"",label:a({id:"Settings.sso.form.defaultRole.label",defaultMessage:"Default role"}),name:"defaultRole",onChange:n=>l({target:{name:"defaultRole",value:n}}),placeholder:a({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),value:e.defaultRole,children:f.map(({id:n,name:K})=>(0,t.jsx)(v.c,{value:n.toString(),children:K},n))})}),(0,t.jsx)(i.E,{col:6,s:12,children:(0,t.jsx)(d.KF,{disabled:!W,hint:a({id:"Settings.sso.form.localAuthenticationLock.description",defaultMessage:"Select the roles for which you want to disable the local authentication"}),error:E.ssoLockedRoles?a({id:E.ssoLockedRoles,defaultMessage:E.ssoLockedRoles}):"",label:a({id:"Settings.sso.form.localAuthenticationLock.label",defaultMessage:"Local authentication lock-out"}),name:"ssoLockedRoles",onChange:n=>l({target:{value:n,name:"ssoLockedRoles"}}),placeholder:a({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),onClear:()=>b("ssoLockedRoles",[]),value:e.ssoLockedRoles||[],withTags:!0,children:f.map(({id:n,name:K})=>(0,t.jsx)(d.fe,{value:n.toString(),children:K},n))})})]})]})})]})})})]})},F=()=>{const a=(0,M.j)(_=>_.admin_app.permissions.settings?.sso?.main);return(0,t.jsx)(o.CheckPagePermissions,{permissions:a,children:(0,t.jsx)(p,{})})}}}]);
