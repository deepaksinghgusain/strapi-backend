"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[6384],{26384:(Y,I,s)=>{s.d(I,{ProtectedListPage:()=>_s});var t=s(92132),M=s(21272),C=s(50215),B=s(94061),W=s(85963),R=s(53563),T=s(88353),U=s(42455),d=s(74773),o=s(4198),E=s(55356),_=s(11273),l=s(38413),v=s(83997),K=s(95579),f=s(35513),y=s(25641),x=s(26127),A=s(90361),i=s(33363),Z=s(40216),P=s(85829),w=s(98765),q=s(49654),r=s(91356),ss=s(36481),ts=s(41909),j=s(5194),F=s(50612),os=s(54894),G=s(17703),as=s(71389),J=s(78803),es=s(28026),Cs=s(15126),Ws=s(63299),Ts=s(67014),vs=s(59080),As=s(79275),Ls=s(14718),cs=s(82437),Is=s(61535),Bs=s(5790),Rs=s(48656),Us=s(35223),Ks=s(5409),fs=s(74930),ys=s(2600),xs=s(48940),js=s(41286),us=s(56336),Ss=s(13426),ps=s(84624),bs=s(77965),$s=s(54257),Ns=s(71210),ks=s(51187),zs=s(39404),Fs=s(58692),Gs=s(501),Js=s(57646),Qs=s(23120),Vs=s(44414),Hs=s(25962),Xs=s(14664),Ys=s(42588),Zs=s(90325),ws=s(62785),qs=s(87443),st=s(41032),tt=s(22957),ot=s(93179),at=s(73055),et=s(15747),nt=s(85306),_t=s(26509),it=s(32058),dt=s(81185),Et=s(82261);const ns=()=>{const[u,D]=M.useState(!1),[is,Q]=M.useState(!1),[S,h]=M.useState([]),ds=(0,J.j)(a=>a.admin_app.permissions.settings?.webhooks),{formatMessage:e}=(0,os.A)(),{_unstableFormatAPIError:L}=(0,r.useAPIErrorHandler)(),O=(0,r.useNotification)();(0,r.useFocusWhenNavigate)();const{push:Es}=(0,G.W6)(),{pathname:V}=(0,G.zy)(),{isLoading:rs,allowedActions:{canCreate:p,canUpdate:b,canDelete:H}}=(0,r.useRBAC)(ds),{notifyStatus:X}=(0,_.W)(),{isLoading:ls,webhooks:g,error:$,updateWebhook:Ms,deleteManyWebhooks:Ps}=(0,es.u)();M.useEffect(()=>{if($){O({type:"warning",message:L($)});return}g&&X(e({id:"Settings.webhooks.list.loading.success",defaultMessage:"Webhooks have been loaded"}))},[g,$,O,e,X,L]);const Ds=async a=>{try{const n=await Ms(a);"error"in n&&O({type:"warning",message:L(n.error)})}catch{O({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}},hs=async()=>{try{Q(!0);const a=await Ps({ids:S});if("error"in a){O({type:"warning",message:L(a.error)});return}h([])}catch{O({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}finally{Q(!1),D(!1)}},Os=a=>h(a?g?.map(n=>n.id)??[]:[]),gs=(a,n)=>h(a?z=>[...z,n]:z=>z.filter(ms=>ms!==n)),N=a=>()=>Es(`${V}/${a}`),k=rs||ls,c=g?.length??0,m=S.length;return(0,t.jsxs)(U.P,{children:[(0,t.jsx)(r.SettingsPageTitle,{name:"Webhooks"}),(0,t.jsxs)(l.g,{"aria-busy":k,children:[(0,t.jsx)(E.Q,{title:e({id:"Settings.webhooks.title",defaultMessage:"Webhooks"}),subtitle:e({id:"Settings.webhooks.list.description",defaultMessage:"Get POST changes notifications"}),primaryAction:p&&!k&&(0,t.jsx)(q.z,{as:as.NavLink,startIcon:(0,t.jsx)(j.A,{}),variant:"default",to:`${V}/create`,size:"S",children:e({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})})}),m>0&&H&&(0,t.jsx)(d.B,{startActions:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(P.o,{variant:"epsilon",textColor:"neutral600",children:e({id:"Settings.webhooks.to.delete",defaultMessage:"{webhooksToDeleteLength, plural, one {# webhook} other {# webhooks}} selected"},{webhooksToDeleteLength:m})}),(0,t.jsx)(W.$,{onClick:()=>D(!0),startIcon:(0,t.jsx)(F.A,{}),size:"L",variant:"danger-light",children:e({id:"global.delete",defaultMessage:"Delete"})})]})}),(0,t.jsx)(o.s,{children:k?(0,t.jsx)(B.a,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(r.LoadingIndicatorPage,{})}):c>0?(0,t.jsxs)(f.X,{colCount:5,rowCount:c+1,footer:(0,t.jsx)(Z.S,{onClick:N("create"),icon:(0,t.jsx)(j.A,{}),children:e({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})}),children:[(0,t.jsx)(x.d,{children:(0,t.jsxs)(A.Tr,{children:[(0,t.jsx)(i.Th,{children:(0,t.jsx)(C.J,{"aria-label":e({id:"global.select-all-entries",defaultMessage:"Select all entries"}),indeterminate:m>0&&m<c,value:m===c,onValueChange:Os})}),(0,t.jsx)(i.Th,{width:"20%",children:(0,t.jsx)(P.o,{variant:"sigma",textColor:"neutral600",children:e({id:"global.name",defaultMessage:"Name"})})}),(0,t.jsx)(i.Th,{width:"60%",children:(0,t.jsx)(P.o,{variant:"sigma",textColor:"neutral600",children:e({id:"Settings.webhooks.form.url",defaultMessage:"URL"})})}),(0,t.jsx)(i.Th,{width:"20%",children:(0,t.jsx)(P.o,{variant:"sigma",textColor:"neutral600",children:e({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})})}),(0,t.jsx)(i.Th,{children:(0,t.jsx)(w.s,{children:e({id:"Settings.webhooks.list.th.actions",defaultMessage:"Actions"})})})]})}),(0,t.jsx)(y.N,{children:g?.map(a=>(0,t.jsxs)(A.Tr,{onClick:b?N(a.id):void 0,style:{cursor:b?"pointer":"default"},children:[(0,t.jsx)(i.Td,{onClick:n=>n.stopPropagation(),children:(0,t.jsx)(C.J,{"aria-label":`${e({id:"global.select",defaultMessage:"Select"})} ${a.name}`,value:S?.includes(a.id),onValueChange:n=>gs(n,a.id),name:"select"})}),(0,t.jsx)(i.Td,{children:(0,t.jsx)(P.o,{fontWeight:"semiBold",textColor:"neutral800",children:a.name})}),(0,t.jsx)(i.Td,{children:(0,t.jsx)(P.o,{textColor:"neutral800",children:a.url})}),(0,t.jsx)(i.Td,{children:(0,t.jsx)(v.s,{children:(0,t.jsx)(K.d,{onLabel:e({id:"global.enabled",defaultMessage:"Enabled"}),offLabel:e({id:"global.disabled",defaultMessage:"Disabled"}),label:`${a.name} ${e({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})}`,selected:a.isEnabled,onChange:n=>{n.stopPropagation(),Ds({...a,isEnabled:!a.isEnabled})},visibleLabels:!0})})}),(0,t.jsx)(i.Td,{children:(0,t.jsxs)(v.s,{gap:1,children:[b&&(0,t.jsx)(T.K,{label:e({id:"Settings.webhooks.events.update",defaultMessage:"Update"}),icon:(0,t.jsx)(ts.A,{}),noBorder:!0}),H&&(0,t.jsx)(T.K,{onClick:n=>{n.stopPropagation(),h([a.id]),D(!0)},label:e({id:"Settings.webhooks.events.delete",defaultMessage:"Delete webhook"}),icon:(0,t.jsx)(F.A,{}),noBorder:!0})]})})]},a.id))})]}):(0,t.jsx)(R.p,{icon:(0,t.jsx)(ss.A,{width:"160px"}),content:e({id:"Settings.webhooks.list.empty.description",defaultMessage:"No webhooks found"}),action:(0,t.jsx)(W.$,{variant:"secondary",startIcon:(0,t.jsx)(j.A,{}),disabled:!p,onClick:p?N("create"):void 0,children:e({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})})})})]}),(0,t.jsx)(r.ConfirmDialog,{isOpen:u,onToggleDialog:()=>D(a=>!a),onConfirm:hs,isConfirmButtonLoading:is})]})},_s=()=>{const u=(0,J.j)(D=>D.admin_app.permissions.settings?.webhooks.main);return(0,t.jsx)(r.CheckPagePermissions,{permissions:u,children:(0,t.jsx)(ns,{})})}},28026:(Y,I,s)=>{s.d(I,{u:()=>U});var t=s(78803);const M=t.n.injectEndpoints({endpoints:d=>({getWebhooks:d.query({query:o=>({url:`/admin/webhooks/${o?.id??""}`,method:"GET"}),transformResponse:o=>Array.isArray(o.data)?o.data:[o.data],providesTags:(o,E,_)=>typeof _=="object"&&"id"in _?[{type:"Webhook",id:_.id}]:[...o?.map(({id:l})=>({type:"Webhook",id:l}))??[],{type:"Webhook",id:"LIST"}]}),createWebhook:d.mutation({query:o=>({url:"/admin/webhooks",method:"POST",data:o}),transformResponse:o=>o.data,invalidatesTags:[{type:"Webhook",id:"LIST"}]}),updateWebhook:d.mutation({query:({id:o,...E})=>({url:`/admin/webhooks/${o}`,method:"PUT",data:E}),transformResponse:o=>o.data,invalidatesTags:(o,E,{id:_})=>[{type:"Webhook",id:_}]}),triggerWebhook:d.mutation({query:o=>({url:`/admin/webhooks/${o}/trigger`,method:"POST"}),transformResponse:o=>o.data}),deleteManyWebhooks:d.mutation({query:o=>({url:"/admin/webhooks/batch-delete",method:"POST",data:o}),transformResponse:o=>o.data,invalidatesTags:(o,E,{ids:_})=>_.map(l=>({type:"Webhook",id:l}))})}),overrideExisting:!1}),{useGetWebhooksQuery:C,useCreateWebhookMutation:B,useUpdateWebhookMutation:W,useTriggerWebhookMutation:R,useDeleteManyWebhooksMutation:T}=M,U=(d=void 0,o)=>{const{data:E,isLoading:_,error:l}=C(d,o),[v,{error:K}]=B(),[f,{error:y}]=W(),[x]=R(),[A]=T();return{webhooks:E,isLoading:_,error:l||K||y,createWebhook:v,updateWebhook:f,triggerWebhook:x,deleteManyWebhooks:A}}}}]);
