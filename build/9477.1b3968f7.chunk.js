"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[9477],{9477:(V,L,s)=>{s.d(L,{ProtectedListPage:()=>ts});var _=s(92132),O=s(21272),g=s(94061),m=s(85963),v=s(88353),B=s(74773),W=s(4198),c=s(55356),D=s(38413),P=s(83997),I=s(35513),U=s(25641),K=s(26127),r=s(90361),E=s(33363),x=s(40216),e=s(85829),G=s(98765),a=s(91356),H=s(90625),X=s(41909),N=s(5194),J=s(50612),Y=s(92803),Z=s(88761),S=s(54894),k=s(17703),F=s(78803),b=s(85071),$=s(66248),Ms=s(15126),Os=s(63299),Ps=s(67014),rs=s(59080),Cs=s(79275),Ts=s(14718),hs=s(82437),Rs=s(61535),As=s(5790),Ls=s(48656),gs=s(35223),ms=s(5409),vs=s(74930),Bs=s(2600),Ws=s(48940),cs=s(41286),Is=s(56336),Us=s(13426),Ks=s(84624),xs=s(77965),fs=s(54257),js=s(71210),us=s(51187),ys=s(39404),ps=s(58692),Ns=s(501),Ss=s(57646),Fs=s(23120),$s=s(44414),zs=s(25962),Qs=s(14664),Vs=s(42588),Gs=s(90325),Hs=s(62785),Xs=s(87443),Js=s(41032),Ys=s(22957),Zs=s(93179),ks=s(73055),bs=s(15747),ws=s(85306),qs=s(26509),s_=s(32058),__=s(81185),t_=s(82261),o_=s(55151),a_=s(79077);const w=({id:t,name:d,description:n,usersCount:C,icons:T,rowIndex:f,canUpdate:h})=>{const{formatMessage:R}=(0,S.A)(),[,M]=T,j=R({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:C});return(0,_.jsxs)(r.Tr,{"aria-rowindex":f,...h?(0,a.onRowClick)({fn:M.onClick}):{},children:[(0,_.jsx)(E.Td,{maxWidth:(0,a.pxToRem)(130),children:(0,_.jsx)(e.o,{ellipsis:!0,textColor:"neutral800",children:d})}),(0,_.jsx)(E.Td,{maxWidth:(0,a.pxToRem)(250),children:(0,_.jsx)(e.o,{ellipsis:!0,textColor:"neutral800",children:n})}),(0,_.jsx)(E.Td,{children:(0,_.jsx)(e.o,{textColor:"neutral800",children:j})}),(0,_.jsx)(E.Td,{children:(0,_.jsx)(P.s,{justifyContent:"flex-end",...a.stopPropagation,children:T.map((l,A)=>l?(0,_.jsx)(g.a,{paddingLeft:A===0?0:1,children:(0,_.jsx)(v.K,{onClick:l.onClick,label:l.label,borderWidth:0,icon:l.icon})},l.label):null)})})]},t)},q=()=>{const{formatMessage:t}=(0,S.A)();(0,a.useFocusWhenNavigate)();const d=(0,F.j)($.s),{formatAPIError:n}=(0,a.useAPIErrorHandler)(),C=(0,a.useNotification)(),[T,f]=O.useState(!1),[{query:h}]=(0,a.useQueryParams)(),{isLoading:R,allowedActions:{canCreate:M,canDelete:j,canRead:l,canUpdate:A}}=(0,a.useRBAC)(d.settings?.roles),{roles:z,refetch:os}=(0,b.u)({filters:h?._q?{name:{$containsi:h._q}}:void 0},{refetchOnMountOrArgChange:!0,skip:R||!l}),{push:u}=(0,k.W6)(),[{showModalConfirmButtonLoading:as,roleToDelete:ns},y]=O.useReducer(_s,ss),{post:Es}=(0,a.getFetchClient)(),ls=async()=>{try{y({type:"ON_REMOVE_ROLES"}),await Es("/admin/roles/batch-delete",{ids:[ns]}),await os(),y({type:"RESET_DATA_TO_DELETE"})}catch(o){o instanceof Y.pe&&C({type:"warning",message:n(o)})}p()},Q=()=>u("/settings/roles/new"),p=()=>f(o=>!o),es=o=>i=>{i.preventDefault(),i.stopPropagation(),o.usersCount?C({type:"info",message:{id:"Roles.ListPage.notification.delete-not-allowed"}}):(y({type:"SET_ROLE_TO_DELETE",id:o.id}),p())},is=o=>i=>{i.preventDefault(),i.stopPropagation(),u(`/settings/roles/duplicate/${o.id}`)},ds=z.length+1,Ds=6;return R?(0,_.jsx)(D.g,{children:(0,_.jsx)(a.LoadingIndicatorPage,{})}):(0,_.jsxs)(D.g,{children:[(0,_.jsx)(a.SettingsPageTitle,{name:"Roles"}),(0,_.jsx)(c.Q,{primaryAction:M?(0,_.jsx)(m.$,{onClick:Q,startIcon:(0,_.jsx)(N.A,{}),size:"S",children:t({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,title:t({id:"global.roles",defaultMessage:"roles"}),subtitle:t({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),as:"h2"}),l&&(0,_.jsx)(B.B,{startActions:(0,_.jsx)(a.SearchURLQuery,{label:t({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:t({id:"global.roles",defaultMessage:"roles"})})})}),l&&(0,_.jsx)(W.s,{children:(0,_.jsxs)(I.X,{colCount:Ds,rowCount:ds,footer:M?(0,_.jsx)(x.S,{onClick:Q,icon:(0,_.jsx)(N.A,{}),children:t({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,children:[(0,_.jsx)(K.d,{children:(0,_.jsxs)(r.Tr,{"aria-rowindex":1,children:[(0,_.jsx)(E.Th,{children:(0,_.jsx)(e.o,{variant:"sigma",textColor:"neutral600",children:t({id:"global.name",defaultMessage:"Name"})})}),(0,_.jsx)(E.Th,{children:(0,_.jsx)(e.o,{variant:"sigma",textColor:"neutral600",children:t({id:"global.description",defaultMessage:"Description"})})}),(0,_.jsx)(E.Th,{children:(0,_.jsx)(e.o,{variant:"sigma",textColor:"neutral600",children:t({id:"global.users",defaultMessage:"Users"})})}),(0,_.jsx)(E.Th,{children:(0,_.jsx)(G.s,{children:t({id:"global.actions",defaultMessage:"Actions"})})})]})}),(0,_.jsx)(U.N,{children:z?.map((o,i)=>(0,_.jsx)(w,{id:o.id,name:o.name,description:o.description,usersCount:o.usersCount,icons:[M&&{onClick:is(o),label:t({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),icon:(0,_.jsx)(H.A,{})},A&&{onClick:()=>u(`/settings/roles/${o.id}`),label:t({id:"app.utils.edit",defaultMessage:"Edit"}),icon:(0,_.jsx)(X.A,{})},j&&{onClick:es(o),label:t({id:"global.delete",defaultMessage:"Delete"}),icon:(0,_.jsx)(J.A,{})}].filter(Boolean),rowIndex:i+2,canUpdate:A},o.id))})]})}),(0,_.jsx)(a.ConfirmDialog,{isOpen:T,onConfirm:ls,isConfirmButtonLoading:as,onToggleDialog:p})]})},ss={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},_s=(t,d)=>(0,Z.Ay)(t,n=>{switch(d.type){case"ON_REMOVE_ROLES":{n.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{n.shouldRefetchData=!0,n.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{n.shouldRefetchData=!1,n.roleToDelete=null,n.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{n.roleToDelete=d.id;break}default:return n}}),ts=()=>{const t=(0,F.j)($.s);return(0,_.jsx)(a.CheckPagePermissions,{permissions:t.settings?.roles.main,children:(0,_.jsx)(q,{})})}},85071:(V,L,s)=>{s.d(L,{u:()=>v});var _=s(21272),O=s(91356),g=s(54894),m=s(78803);const v=(B={},W)=>{const{locale:c}=(0,g.A)(),D=(0,O.useCollator)(c,{sensitivity:"base"}),{data:P,error:I,isError:U,isLoading:K,refetch:r}=(0,m.z)(B,W);return{roles:_.useMemo(()=>[...P??[]].sort((x,e)=>D.compare(x.name,e.name)),[P,D]),error:I,isError:U,isLoading:K,refetch:r}}}}]);
